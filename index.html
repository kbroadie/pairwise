<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Pairwise Survey</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Platypi:ital,wght@0,300..800;1,300..800&family=Radio+Canada:ital,wght@0,300..700;1,300..700&display=swap');
body { background-color: #23272a; color: #919395; font-family: Arial, sans-serif; display: flex; flex-direction: column; justify-content: space-between; height: 100vh; margin: 0; }
main { flex: 1; display: flex; flex-direction: column; justify-content: center; position: relative; }
.term-pair { display: flex; justify-content: center; align-items: center; height: 66vh; position: relative; margin-top: -10vh; }
.term-button { width: 40%; height: 80%; margin: 0 15px; padding: 40px; font-size: clamp(2rem, 4vw, 4rem); background-color: #1c2124; color: #919395; border: none; border-radius: 20px; cursor: pointer; position: relative; font-family: 'Platypi', sans-serif; font-weight: 300; }
.term-button.selected { background-color: #00660f; color: #fff; }
.term-button:focus { outline: none; }
.circle-container { display: flex; justify-content: center; align-items: center; position: relative; height: 6vh; width: 80vw; margin: 0.3em auto; }
.circle { display: flex; justify-content: center; align-items: center; font-size: 3em; width: 12.5%; aspect-ratio: 1 / 1; margin: 0 0.15em; border-radius: 10%; cursor: pointer; font-family: 'Radio Canada', sans-serif; font-style: Regular; font-weight: 500; transition: background-color 0.3s, opacity 0.3s, color 0.3s, transform 0.3s; }
.circle:not(.ghost):hover { transform: scale(1.05); background-color: #00660f !important; color: #fff !important; }
.circle.ghost { opacity: 0.5; pointer-events: none; }
.term-pair:not(:has(.term-button.selected)) ~ .circle-container .circle:hover { transform: none; background-color: inherit !important; color: inherit !important; }
#next-button, #previous-button { font-size: 1em; display: flex; align-items: center; justify-content: center; color: #919395; border: none; border-radius: 0; position: fixed; top: 0; height: 100vh; width: 9vw; transition: background 0.3s, opacity 0.3s; cursor: pointer; z-index: 1000; }
#previous-button { left: 0; height: 95vh; color: transparent; background: linear-gradient(90deg, rgba(70,78,84,0) 0%, rgba(70,78,84,0) 100%); }
#next-button { right: 0; color: transparent; background: linear-gradient(270deg, rgba(70,78,84,.4) 0%, rgba(70,78,84,0) 100%); }
#progress-bar { width: 100%; background-color: #333; height: 10px; position: absolute; bottom: 0; z-index: 1001; }
#count { text-align: right; color: #666; margin-bottom: 15px; margin-right: 10px; opacity: 0.5; position: absolute; bottom: 0; right: 0; z-index: 1001; }
#progress { width: 0; height: 100%; background-color: #00660f; }
#auto-advance-container { position: absolute; bottom: 20px; left: 10px; width: 30px; height: 30px; z-index: 1001; }
#auto-advance-icon { width: 100%; height: 100%; cursor: pointer; fill: #666; opacity: 0.5; transition: fill 0.3s, opacity 0.3s; }
#auto-advance-icon:hover { fill: #666; opacity: 1; }
#auto-advance-icon.active { fill: #666; opacity: 1; }
#fullscreen-container { position: absolute; bottom: 20px; left: 50px; width: 30px; height: 30px; z-index: 1001; }
#fullscreen-icon { width: 100%; height: 100%; cursor: pointer; fill: #666; opacity: 0.5; transition: fill 0.3s, opacity 0.3s; }
#fullscreen-icon:hover { fill: #666; opacity: 1; }
#results { text-align: left; margin-top: 20px; }
#chart-container { width: 70%; height: 90vh; margin: 20px auto; background-color: #1c2124; border-radius: 20px;}
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
</head>
<body>
<button id="previous-button">&#9664;</button>
<button id="next-button">&#9654;</button>
<main>
<div id="survey"></div>
<div id="count"></div>
<div id="auto-advance-container"><svg id="auto-advance-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 105.26 100.63" width="30" height="30"><path d="M32.47 70.52h10.64l3.23-11.65h13l3.5 11.65h11.05l-14.08-45.4H46.34L32.46 70.52zm18.05-28.96c.74-2.63 1.42-6.06 2.09-8.76h.13c.67 2.69 1.48 6.06 2.29 8.76l2.83 9.63H47.82l2.7-9.63zm2.38 50.99c-17.46 0-33.16-10.93-39.38-27l6.19-1.97L4.43 49.65 0 69.85l5.8-1.85c7.29 19.39 26.12 32.63 47.1 32.63 22.29 0 42.17-14.96 48.34-36.37l-7.76-2.24c-5.18 17.97-21.87 30.52-40.58 30.52zM52.9 8.08c16.71 0 31.8 10.02 38.53 24.96l-5.87 1.87 15.28 13.93 4.42-20.2-6.08 1.94C91.36 12.31 73.12 0 52.9 0 30.6 0 10.72 14.96 4.56 36.37l7.76 2.24C17.5 20.64 34.18 8.09 52.9 8.08z"/></svg></div>
<div id="fullscreen-container"><svg id="fullscreen-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="30" height="30"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg></div>
<div id="progress-bar"><div id="progress"></div></div>
<div id="results"></div>
</main>
<script>
const terms = ["Improve Pavement Condition", "Fill System Gaps", "Reduce Congestion", "Reduce Accidents", "Encourage Infill Development", "Improve Climate & Disaster Resiliency", "Improve Access In & Out of the Coachella Valley", "Add Pedestrian & Bicycle Routes", "Improve Air Quality, Environment, and Aesthetics", "Improve Access In & Out of Events", "Build Infrastructure in Disadvantaged Communities", "Improve Mobility for Disadvantaged People"];
const responses = [], pairs = [];
let currentPairIndex = 0, selectedCircleIndices = [];
const createSurvey = () => { for (let e = 0; e < terms.length; e++) for (let t = e + 1; t < terms.length; t++) pairs.push([terms[e], terms[t]]); selectedCircleIndices = Array(pairs.length).fill(null); showNextPair(); };
const showNextPair = () => { let e = document.getElementById("survey"); if (e.innerHTML = "", currentPairIndex < pairs.length) { let [t, r] = pairs[currentPairIndex], n = document.createElement("div"); n.classList.add("question"); n.innerHTML = `<div class="term-pair"><button class="term-button ${responses[currentPairIndex] === t ? "selected" : ""}" onclick="selectTerm('${t}', 0)" aria-label="Select ${t}">${t}</button><button class="term-button ${responses[currentPairIndex] === r ? "selected" : ""}" onclick="selectTerm('${r}', 1)" aria-label="Select ${r}">${r}</button></div><div class="circle-container">${Array.from({ length: 8 }).map((e, n) => `<div class="circle circle-${getCircleNumber(n)} ${selectedCircleIndices[currentPairIndex] === n ? "selected" : ""}" onclick="selectCircle(${n})" style="${4 === n ? "margin-left: 30px;" : ""}">${getCircleNumber(n)}</div>`).join("")}</div>`; e.appendChild(n); updateCount(); updateProgressBar(); updateTermButtonColors(); updateCircleColors(); updateButtonVisibility(); } else showResults(); };
const showPreviousPair = () => { currentPairIndex > 0 && (currentPairIndex--, showNextPair()); };
const advanceToNextPair = () => { if (responses[currentPairIndex] && null !== selectedCircleIndices[currentPairIndex]) { let nextButton = document.getElementById("next-button"); let autoAdvanceEnabled = document.getElementById("auto-advance-icon").classList.contains("active"); if (!autoAdvanceEnabled) { nextButton.style.background = "linear-gradient(270deg, rgba(70,78,84,.6) 0%, rgba(70,78,84,0) 100%)"; setTimeout(() => { currentPairIndex++; currentPairIndex >= pairs.length ? showResults() : showNextPair(); nextButton.style.background = "linear-gradient(270deg, rgba(70,78,84,.4) 0%, rgba(70,78,84,0) 100%)"; }, 150); } else { currentPairIndex++; currentPairIndex >= pairs.length ? showResults() : showNextPair(); } } };
const selectTerm = (e, t) => { let r = document.querySelectorAll(".term-button"), n = r[t].classList.contains("selected"), o = r[1 - t].classList.contains("selected"); r.forEach((e, r) => { r === t ? e.classList.toggle("selected") : e.classList.remove("selected"); }); n ? (responses[currentPairIndex] = void 0, deselectCircle()) : (responses[currentPairIndex] = e, o && deselectCircle()); updateTermButtonColors(); updateButtonVisibility(); updateCircleColors(); };
const selectCircle = (e) => { let t = document.querySelectorAll(".circle"), r = !1; t.forEach((t, n) => { n === e ? t.classList.contains("selected") ? (t.classList.remove("selected"), r = !0) : (t.classList.add("selected"), selectAssociatedTerm(n)) : t.classList.remove("selected"); }); r ? selectedCircleIndices[currentPairIndex] = null : selectedCircleIndices[currentPairIndex] = e; updateButtonVisibility(); updateCircleColors(); let o = document.getElementById("auto-advance-icon"); o.classList.contains("active") && setTimeout(() => { advanceToNextPair(); }, 250); };
const selectAssociatedTerm = (e) => { let t = document.querySelectorAll(".term-button"), r = e < 4 ? 0 : 1, n = pairs[currentPairIndex][r]; t.forEach((e, t) => { t === r ? e.classList.add("selected") : e.classList.remove("selected"); }); responses[currentPairIndex] = n; updateTermButtonColors(); };
const deselectCircle = () => { let e = document.querySelectorAll(".circle"); e.forEach(e => e.classList.remove("selected")); selectedCircleIndices[currentPairIndex] = null; };
const updateCircleColors = () => { let e = document.querySelectorAll(".circle"), t = getSelectedTermIndex(); e.forEach((e, r) => { let n = getCircleNumber(r), o = { h: 34 - 6 * (n - 1), s: 90 - 10 * (n - 1), l: 40 }; if (r === selectedCircleIndices[currentPairIndex]) e.style.backgroundColor = "#00660f", e.style.color = "#ffffff", e.classList.remove("ghost"); else { let n = 0; -1 === t ? n = 0 : r < 4 && 0 === t || r >= 4 && 1 === t ? n = 1 : void 0; e.style.backgroundColor = `hsla(${o.h}, ${o.s}%, ${o.l}%, ${n})`; let i = 0 === n ? increaseLuminosity(hexToHSL("#23272a"), 30) : increaseLuminosity(o, 30); e.style.color = i; -1 === t || r < 4 && 0 === t || r >= 4 && 1 === t ? e.classList.remove("ghost") : e.classList.add("ghost"); } e.style.opacity = e.classList.contains("ghost") ? "0.5" : "1"; }); };
const updateButtonVisibility = () => { let e = document.getElementById("next-button"), t = document.getElementById("previous-button"), autoAdvanceEnabled = document.getElementById("auto-advance-icon").classList.contains("active"); if (responses[currentPairIndex] && null !== selectedCircleIndices[currentPairIndex]) { e.style.transition = "opacity 300ms"; e.style.opacity = "1"; e.style.pointerEvents = "auto"; } else { e.style.transition = "none"; e.style.opacity = "0"; e.style.pointerEvents = "none"; } t.style.opacity = currentPairIndex > 0 ? "1" : "0.3"; t.style.pointerEvents = currentPairIndex > 0 ? "auto" : "none"; if (autoAdvanceEnabled) { e.style.display = "none"; } else { e.style.display = "flex"; } };
const updateTermButtonColors = () => { document.querySelectorAll(".term-button").forEach(e => { e.classList.contains("selected") ? (e.style.backgroundColor = "#00660f", e.style.color = "#ffffff") : (e.style.backgroundColor = "#1c2124", e.style.color = increaseLuminosity(hexToHSL("#1c2124"), 80)); }); };
const updateCount = () => { let e = document.getElementById("count"); e.innerHTML = `${currentPairIndex + 1} of ${pairs.length}`; };
const updateProgressBar = () => { let e = document.getElementById("progress"), t = (currentPairIndex + 1) / pairs.length * 100; e.style.width = `${t}%`; };
const showResults = () => { let main = document.querySelector("main"); let scores = calculateTermScores(); let sortedScores = Object.entries(scores).sort((a, b) => b[1] - a[1]); main.innerHTML = ""; let chartContainer = document.createElement("div"); chartContainer.id = "chart-container"; main.appendChild(chartContainer); let canvas = document.createElement("canvas"); canvas.id = "resultsChart"; chartContainer.appendChild(canvas); const ctx = canvas.getContext('2d'); const primaryColor = '#00660f'; const secondaryColor = '#3e4449'; let priorityStatus = new Array(sortedScores.length).fill(false); const chart = new Chart(ctx, { type: 'bar', data: { labels: sortedScores.map(([term, _]) => term), datasets: [{ data: sortedScores.map(([_, score]) => score), backgroundColor: new Array(sortedScores.length).fill(secondaryColor), borderRadius: 6, borderSkipped: false, }] }, options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, tooltip: { enabled: false }, }, scales: { x: { stacked: true, grid: { display: false }, ticks: { display: false }, border: { display: false } }, y: { stacked: true, grid: { display: false }, ticks: { display: false }, border: { display: false } } }, layout: { padding: { left: 40, right: 40, top: 80, bottom: 20 } }, barThickness: 67, barPercentage: .9, categoryPercentage: 0.9, animation: { duration: 2000, easing: 'easeOutQuart' }, onClick: (event, elements) => { if (elements.length > 0) { const index = elements[0].index; priorityStatus[index] = !priorityStatus[index]; chart.data.datasets[0].backgroundColor[index] = priorityStatus[index] ? primaryColor : secondaryColor; chart.update('active'); } }, }, plugins: [{ id: 'custom-background', beforeDraw: (chart) => { const ctx = chart.ctx; ctx.save(); ctx.fillStyle = '#1c2124'; ctx.fillRect(0, 0, chart.width, chart.height); ctx.restore(); } }, { afterDraw: chart => { const ctx = chart.ctx; const xAxis = chart.scales.x; const yAxis = chart.scales.y; ctx.textAlign = 'center'; ctx.font = '400 30px "Radio Canada"'; ctx.fillStyle = '#b0b0b0'; ctx.fillText('RESULTS', chart.width / 2, 50); chart.data.datasets[0].data.forEach((datapoint, index) => { const y = yAxis.getPixelForTick(index); const x = xAxis.getPixelForValue(datapoint); ctx.save(); ctx.textBaseline = 'middle'; const label = chart.data.labels[index]; const score = datapoint; const isPriority = priorityStatus[index]; ctx.font = isPriority ? '300 32px "Platypi"' : '300 26px "Platypi"'; ctx.textAlign = 'left'; ctx.fillStyle = isPriority ? '#deefde' : '#b0b0b0'; const labelWidth = ctx.measureText(label).width; ctx.fillText(label, xAxis.left + 20, y); ctx.font = isPriority ? '400 20px "Radio Canada"' : '400 18px "Radio Canada"'; ctx.textAlign = 'left'; ctx.fillStyle = isPriority ? '#ffffff' : '#b0b0b0'; const barWidth = x - xAxis.left; const animationProgress = chart.getDatasetMeta(0).data[index].x / x; const scoreWidth = ctx.measureText(score.toString()).width; let scoreX; if (barWidth * animationProgress > labelWidth + 120) { scoreX = xAxis.left + (barWidth * animationProgress) - scoreWidth - 20; } else { scoreX = xAxis.left + labelWidth + 60; } ctx.fillText(score, scoreX, y); ctx.restore(); }); } }] }); ["#survey", "#count", "#auto-advance-container", "#progress-bar", "#previous-button", "#next-button"].forEach(selector => { let element = document.querySelector(selector); if (element) element.remove(); }); };const calculateTermScores = () => { let e = {}; return terms.forEach(t => e[t] = 0), responses.forEach((t, r) => { if (void 0 !== t && null !== selectedCircleIndices[r]) { let n = getCircleNumber(selectedCircleIndices[r]); e[t] += n; } }), e; };
const hexToHSL = (e) => { let t = 0, r = 0, n = 0; 4 == e.length ? (t = parseInt(e[1] + e[1], 16), r = parseInt(e[2] + e[2], 16), n = parseInt(e[3] + e[3], 16)) : 7 == e.length && (t = parseInt(e.slice(1, 3), 16), r = parseInt(e.slice(3, 5), 16), n = parseInt(e.slice(5, 7), 16)); t /= 255, r /= 255, n /= 255; let o = Math.min(t, r, n), i = Math.max(t, r, n), l = i - o, a = 0, s = 0, c = 0; return a = 0 == l ? 0 : i == t ? (r - n) / l % 6 : i == r ? (n - t) / l + 2 : (t - r) / l + 4, a = Math.round(60 * a), a < 0 && (a += 360), c = (i + o) / 2, s = 0 == l ? 0 : l / (1 - Math.abs(2 * c - 1)), s = +(100 * s).toFixed(1), c = +(100 * c).toFixed(1), { h: a, s: s, l: c }; };
const increaseLuminosity = (e, t) => `hsl(${e.h}, ${e.s}%, ${Math.min(e.l + t, 100)}%)`;
const getCircleNumber = (e) => [4, 3, 2, 1, 1, 2, 3, 4][e];
const getSelectedTermIndex = () => { let e = document.querySelectorAll(".term-button"); return e[0].classList.contains("selected") ? 0 : e[1].classList.contains("selected") ? 1 : -1; };
const toggleAutoAdvance = () => { const autoAdvanceIcon = document.getElementById("auto-advance-icon"); autoAdvanceIcon.classList.toggle("active"); const isActive = autoAdvanceIcon.classList.contains("active"); const nextButton = document.getElementById("next-button"); const previousButton = document.getElementById("previous-button"); if (isActive) { nextButton.style.transition = "none"; previousButton.style.transition = "none"; nextButton.style.display = "none"; } else { nextButton.style.transition = "background 0.3s, opacity 0.3s"; previousButton.style.transition = "background 0.3s, opacity 0.3s"; nextButton.style.display = "flex"; } updateButtonVisibility(); };
const toggleFullscreen = () => !document.fullscreenElement ? document.documentElement.requestFullscreen().catch(err => {}) : document.exitFullscreen && document.exitFullscreen();
const updateFullscreenIcon = () => { const fullscreenIcon = document.getElementById('fullscreen-icon'); document.fullscreenElement ? fullscreenIcon.innerHTML = '<path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/>' : fullscreenIcon.innerHTML = '<path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>'; };
document.getElementById("fullscreen-container").addEventListener("click", toggleFullscreen);
document.addEventListener("fullscreenchange", updateFullscreenIcon);
document.getElementById("auto-advance-container").addEventListener("click", toggleAutoAdvance);
document.getElementById("previous-button").addEventListener("click", showPreviousPair);
document.getElementById("next-button").addEventListener("click", advanceToNextPair);
document.addEventListener('DOMContentLoaded', () => { document.fonts.ready.then(() => { createSurvey(); }); });
window.addEventListener('resize', () => { if (document.getElementById('resultsChart')) { showResults(); } });
</script>
</body>
</html>
